# sr-benchmarks

A suite of scripts to clone, build, label, and check RAT, PR, and SR proof benchmarks.

This suite of benchmarks is associated with the [FMCAD 2024](https://fmcad.org/FMCAD24/) submission titled
"Verified Substitution Redundancy Checking,"
by [Cayden R. Codel](https://crcodel.com), [Jeremy Avigad](https://www.andrew.cmu.edu/user/avigad/), and [Marijn J. H. Heule](https://www.cs.cmu.edu/~mheule/).
You can use these scripts to replicate our experimental results.

## Source of benchmarks and checkers

All repositories are public on GitHub.
Their names (with linked URLs) are as follows:
- [`drat-trim`](https://github.com/marijnheule/drat-trim): an unverified DRAT proof checker/labeler,
along with `lrat-check`, an unverified LRAT proof checker.
- [`dpr-trim`](https://github.com/marijnheule/dpr-trim): an unverified DPR proof checker/labeler,
along with `lpr-check`, an unverified LPR proof checker.
- [`dsr-trim`](https://github.com/ccodel/dsr-trim): an unverified DSR proof checker/labeler,
along with `lsr-check`, an unverified LSR proof checker.
- [`cake_lpr`](https://github.com/tanyongkiam/cake_lpr): a verified LPR proof checker, written in [CakeML](https://cakeml.org/).
- [`pr-proofs`](https://github.com/marijnheule/pr-proofs): a set of hard PR proofs.
- [`sr-proofs`](https://github.com/marijnheule/sr-proofs): a set of hard SR proofs.

In addition, the benchmark suite expects an executable called `lean-lsr-check` to be added at the root level of the suite.
Because the [installation](https://lean-lang.org/lean4/doc/quickstart.html) of the [Lean 4 theorem prover](https://lean-lang.org/) is a little complicated,
and the [LeanSAT repository](https://github.com/JamesGallicchio/LeanSAT) contains far more code than just the checker,
we do not clone/build the verified Lean LSR checker in this benchmark suite.
Instead, please compile it separately and add it yourself.
However, many of our results can be replicated without the Lean checker, as only the scripts that use the Lean checker require it to be present.

## How to use the benchmarking suite

The scripts are organized into directories based on their function, and should be run in roughly this order:
- `clone/`: Clones the (public) proof and proof checker repositories from GitHub.
- `build/`: Compiles the proof checkers and any proofs that require scripting to generate (e.g., pigeonhole).
- `experiments/`, `run/`: Runs the various proof checkers to generate labeled proofs (`.lpr`, `.lsr`),
and runs other proof checkers to check the generated proofs. Run times and file sizes are automatically recorded and stored in the `results/` directory (which these scripts create, if the directory does not already exist).
- `collate/`: Parses the `.txt` files in the `results/` directory and collates the run times and file sizes into `.csv` files. The collated results are stored in `results/collated/`.
- `clean/`: Removes compiled proof checkers/proofs, particularly the large DRAT proofs generated by `sr2drat`.

At the root level of the project are the scripts `clone_all.sh`, `build_all.sh`, `label_all.sh`, `check_all.sh`, `collate_all.sh`, and `clean_all.sh`.
Running these scripts in this order (or running `all.sh`) will replicate all our results and then remove generated proofs.

Alternatively, you can run just our experiments by running `run_experiments.sh` after cloning and building.

In the case where the `.sh` scripts are not executable, run `./configure.sh`.
(You may have to `chmod +x configure.sh` first.)

## System requirements and notes on running experiments

Our experiments were run on a 2022 M1 Mac Studio with 32 GB of memory and a clock speed of 3.2 GHz.
Proof generation on our machine takes about an hour,
and proof checking takes a similar amount of time.
The proofs that take the longest time to label are `mchess-40.pr`, `mchess-50.pr`, `M9.pr`, and `M10.pr` from `pr-proofs` with `dpr-trim` with backwards checking (the default option).
To exclude these long proofs, run `label_quick.sh`.

In total, the proofs are about 3 GB in size.
The largest proofs are the ones generated by `sr2drat` when converting from DSR to DRAT.
If disk space is an issue on your machine, you might want to run these experiments one file at a time.
*TODO: Provide a script that does this.

The `cake_lpr` proof checker expects an x86 architecture during compilation.
The `cake_lpr` repository provides a `Makefile` with an alternate recipe for compiling for ARM machines.
If `./build/build_checkers.sh` produces an error for `cake_lpr` due to this issue, follow the instructions added by the script.
We had to compile `cake_lpr` by hand on our Mac Studio.